<div class="container py-5">
  <h1 class="text-center mb-5 display-5 fw-semibold text-daek">Alpha Bloggers</h1>

  <div class="row justify-content-center">
    <% @users.each do |user| %>
      <% if user == current_user  || !user.is_blocked || current_user&.admin?%>
        <div class="col-6 mb-4">
          <div class="card h-100 shadow border-0 rounded-4 overflow-hidden">
            <div class="row g-0 h-100">
              
              <div class="col-md-4 bg-light d-flex align-items-center justify-content-center p-3 <%='grayscale-wrapper' if user != current_user && user.is_blocked%>">
                <% avatar_number = (user.id % 8).zero? ? 8 : (user.id % 8) %>
                <img src="https://bootdey.com/img/Content/avatar/avatar<%= avatar_number %>.png"
                    class="rounded-circle border border-3 border-primary"
                    alt="User Avatar"
                    style="width: 110px; height: 110px; object-fit: cover;" />
              </div>

              <div class="col-md-8">
                <div class="card-body d-flex flex-column justify-content-between h-100 px-4 py-3">
                  <div>
                    <h5 class="card-title mb-1 fw-bold text-dark"><%= user.username %></h5>
                    <p class="text-muted mb-2 small"><i class="fas fa-envelope me-1"></i> <%= user.email %></p>

                    <div class="mb-2">
                      <span class="d-inline-flex align-items-center me-2 mb-2 px-3 py-1 fw-semibold text-dark bg-white rounded-pill shadow-sm"
                            style="border: 1px solid #ccc; border-left: 6px solid <%= color_for_category(user.articles.first) %>; font-size: 0.75rem;">
                        <%= pluralize(user.articles.where(is_blocked: false).count, "Article") %>
                      </span>
                      <% if user.is_blocked %>
                        <span class="d-inline-flex align-items-center me-2 mb-2 px-3 py-1 fw-semibold text-dark bg-white rounded-pill shadow-sm"
                              style="border: 1px solid #ccc; border-left: 6px solid <%= color_for_category(user.articles.first) %>; font-size: 0.75rem;">
                          Blocked
                        </span>
                      <% end %>
                      <% if user.admin?%>
                        <span class="d-inline-flex align-items-center me-2 mb-2 px-3 py-1 fw-semibold text-dark bg-white rounded-pill shadow-sm"
                              style="border: 1px solid #ccc; border-left: 6px solid <%= color_for_category(user.articles.first) %>; font-size: 0.75rem;">
                          Admin
                        </span>
                      <% end %>
                    </div>

                    <p class="text-muted small"><i class="fas fa-clock me-1"></i> Joined <%= time_ago_in_words(user.created_at) %> ago</p>
                  </div>

                  <div class="row g-2 mt-2">
                    <div class="col-6">
                      <%= link_to user_path(user),
                          class: "btn btn-sm btn-outline-success rounded-pill w-100 shadow-sm",
                          style: "transition: box-shadow 0.3s ease;" do %>
                        <i class="fas fa-user me-2"></i> View
                      <% end %>
                    </div>

                    <% if logged_in? && user == current_user %>
                      <div class="col-6">
                        <%= link_to edit_user_path(user),
                            class: "btn btn-sm btn-outline-primary rounded-pill w-100 shadow-sm",
                            style: "transition: box-shadow 0.3s ease;" do %>
                          <i class="fas fa-edit me-2"></i> Edit
                        <% end %>
                      </div>
                    <% else %>
                      <div class="col-6"></div>
                    <% end %>

                    <% if logged_in? && current_user.admin? && (!user.admin? || user == current_user) %>
                      <div class="col-6">
                        <%= button_to user_path(user), method: :delete,
                            class: "btn btn-sm btn-outline-danger rounded-pill w-100 shadow-sm",
                            data: { turbo_confirm: "Are you sure you want to delete this user?" },
                            style: "transition: box-shadow 0.3s ease;" do %>
                          <i class="fas fa-trash-alt me-2"></i> Delete
                        <% end %>
                      </div>

                      <% if user != current_user && !user.admin? %>
                        <div class="col-6">
                          <% if user.is_blocked %>
                            <%= button_to unblock_user_path(user), method: :post,
                                class: "btn btn-sm btn-outline-secondary rounded-pill w-100 shadow-sm",
                                data: { turbo_confirm: "Are you sure you want to unblock this user?" },
                                style: "transition: box-shadow 0.3s ease;" do %>
                              <i class="fas fa-unlock me-2"></i> Unblock
                            <% end %>
                          <% else %>
                            <%= button_to block_user_path(user), method: :post,
                                class: "btn btn-sm btn-outline-secondary rounded-pill w-100 shadow-sm",
                                data: { turbo_confirm: "Are you sure you want to block this user?" },
                                style: "transition: box-shadow 0.3s ease;" do %>
                              <i class="fas fa-user-slash me-2" style="color: grey;"></i> Block
                            <% end %>
                          <% end %>
                        </div>
                      <% end %>
                    <% end %>
                  </div>
                </div>
              </div>

            </div>
          </div>
        </div>
      <% end %>
    <% end %>
  </div>

  <% if @users.total_pages > 1 %>
    <div class="mt-4 text-center">
      <%= will_paginate @users, container: false, class: "pagination justify-content-center" %>
    </div>
  <% end %>
</div>
